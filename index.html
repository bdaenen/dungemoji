<!doctype html><meta charset="utf-8"><style type="text/css">*{margin:0;padding:0;color:#aaa}html{height:100%;background:#383838}body{position:relative}.b,.col,.g,.r{display:inline-block}.b,.g,.r{height:15px;margin-right:10px;width:15px}.col{width:33%}.r{background:#b00}.g{background:#0b0}.b{background:#00b}#m table,.emo,canvas{color:red;font-size:3em;font-family:'Segoe Ui Emoji',sans-serif}#m table{table-layout:fixed;width:960px;height:360px;border:5px solid green;text-align:center;border-collapse:collapse;background-color:#633f19;margin:0 auto}.emo,canvas{margin:0}.enemy #m table{border:5px solid red}#m table:first-of-type tr:last-child td{border-bottom:0}td,tr{width:100%;height:33%}td{border:10px solid rgba(123,77,29,.4);width:33%;position:relative}li,ul{list-style:none;margin:0;padding:0}#p tr:first-child td{border-top:0}.a{display:none;top:0;bottom:0;background-color:rgba(0,0,0,.5);width:100%;z-index:1}.a li{position:relative;display:inline-block;font-size:40px;height:80px;width:80px;vertical-align:middle;line-height:80px;top:30px}#mm,.a,.a li:after{position:absolute}.a li:after{content:'‚óº';z-index:-1;font-size:100px;width:80px;height:85px;top:-5px;left:0}.valid{background:rgba(0,200,0,.3)}td .a{display:block}.turn{position:absolute;right:0;top:55%;transform:translate(-50%,-50%);background:rgba(0,0,0,.8);padding:20px;color:green;font-size:40px}.enemy .turn{top:45%;bottom:auto;color:red}.a li[data-action-id=endTurn]:before{content:'';position:absolute;top:25px;bottom:40px;width:auto;background:#0078d7;left:20px;right:22px}.health,.view{pointer-events:none}.health{font-size:20px}.view{opacity:1}.view.hasActed{opacity:.5}.noRange{filter:grayscale(100%) brightness(40%) sepia(100%) hue-rotate(-50deg) saturate(600%) contrast(.8)}#mm{top:50%;left:-20px;transform:translate(-100%,-50%);opacity:1}#mm li,#mm ul{background:#633f19}#mm ul{border-top:5px solid red;border-bottom:5px solid green;width:100%}#mm li{height:40px;width:100px;border:4px solid #000}#mm .active,.c{position:relative}#mm .active{background:green}#mm .active:before{background:red;content:'';position:absolute;width:100%;height:100%;opacity:.3;transform:translateY(calc(-100% - 8px))}#log,.c{margin:0 auto}.c{width:960px}#log{overflow-y:scroll;height:150px;width:200px;font-family:'Segoe Ui Emoji',sans-serif}#log::-webkit-scrollbar{width:0;background:0 0}</style><div id="m"><ul class="a"></ul><div class="c"><table id="e"><tr id="e-b"><td id="e-b-l"></td><td id="e-b-c"></td><td id="e-b-r"></td></tr><tr id="e-m"><td id="e-m-l"></td><td id="e-m-c"></td><td id="e-m-r"></td></tr><tr id="e-f"><td id="e-f-l"></td><td id="e-f-c"></td><td id="e-f-r"></td></tr></table><table id="p"><tr id="p-f"><td id="p-f-l"></td><td id="p-f-c"></td><td id="p-f-r"></td></tr><tr id="p-m"><td id="p-m-l"></td><td id="p-m-c"></td><td id="p-m-r"></td></tr><tr id="p-b"><td id="p-b-l"></td><td id="p-b-c"></td><td id="p-b-r"></td></tr></table><div id="mm"><ul><li></li><li></li><li></li><li class="active"></li><li></li><li></li></ul></div></div></div><div class="c"><div id="log"></div></div><div class="turn">Player Turn</div><div class="i"><div class="col"><p>Turns are 1 character a time. Move and atk can occur in any order.</p><p>Click a character to select its action.</p></div><div class="col"><p>Goal: Clear the frontal enemy row, then make the warrior push. Push the last lane to win.</p></div><div class="col"><p><span class="r"></span>High HP, low atk. Can push enemy's lane. Low dodge chance.</p><p><span class="g"></span>Low HP, high atk. Can attack ranged or diagonal. High dodge chance.</p><p><span class="b"></span>Very low HP, avg atk. Can attack all in a row, ranged. Can't dodge.</p></div></div><script>var d=document,w=window;window.$=d.querySelector.bind(d),w.$$=d.querySelectorAll.bind(d),w.find=function(n,e){return n.querySelectorAll(e)},w.log=function(n){var e=$("#log");e.innerText+=[].join.call(arguments," ")+"\n",e.scrollTop=e.scrollHeight},window.dp=Object.defineProperty.bind(Object),window.n=null</script><script>!function(){"use strict";var t=function(t){var e=this;e.stage=t,e.pos={x:0,y:0},e.str=1,e.dex=10,e.int=10,e._sta=6,e.maxHealth=this._sta,e._health=this._sta,e.type=t.P,e.view="üò°",e.$field=n,e.$view=n,e.curAction=n,e.rotate=0,e.hueRotate=0,e.saturate=100,e._hasAttacked=!1,e._hasMoved=!1,e._hasActed=!1,e._alive=!0,e._actions=[{actionId:"move",view:"üèÉ",range:1,type:t.P},{actionId:"attack",view:"üó°",range:1,rangeX:0,type:t.E},{actionId:"endTurn",view:"üîö",type:t.P}]};t.prototype={move:function(t,e){return t instanceof Node?this.move(+t.dataset.x,+t.dataset.y):this.stage.pInF(this.stage.fByC(t,e))?(console.warn("cant move to occupied field"),!1):(this.pos.x=t,this.pos.y=e,this.stage.dirty=!0,void(this.playerTarget?log(this.view,"moves towards",this.playerTarget.view):log(this.view,"moves")))},attack:function(t){if(t){var e=this.stage.pInF(t),i=1;log(this.view,"attacks",e.view),Math.random()>e.dex/100?(Math.random()<this.dex/150&&(i=2)&&log("Critical hit!"),log(e.view,"receives",2*this.str*i,"damage"),e.health-=2*this.str*i):log(e.view,"dodged!")}},selectAction:function(t){this.curAction=this.actions.filter(function(e){return e.actionId===t})[0],this.curAction.range?(this.hideValidActionTargets(),this.renderValidActionTargets(this.curAction),this.stage.state=this.stage.S_TAR):this.performSelectedAction()},performSelectedAction:function(t){var e=this.curAction.actionId;this.stage.hideSelectAction(),this[e](t),"move"===e?this.hasMoved=!0:"attack"===e?this.hasAttacked=!0:"endTurn"===e&&this.endTurn(),this.hideValidActionTargets(),this.stage.dirty=!0},endTurn:function(){this.stage.turn===this.type&&(this.hasActed=!0,this.stage.endTurn())},getValidActionTargets:function(t){var e,i,a,s,n,h=this;if(t.type===h.stage.P){for(e=h.type===h.stage.P?h.stage.pFByC.bind(h.stage):h.stage.eFByC.bind(h.stage),i=h.pos.x,a=h.pos.y,s=[],n=1;n<=t.range;n++)s=s.concat([e(i+n,a),e(i-n,a),e(i,a+n),e(i,a-n)]);s=s.filter(function(t){return t&&!find(t,".view").length})}if(t.type===h.stage.E){for(e=h.type===h.stage.P?h.stage.eFByC.bind(h.stage):h.stage.pFByC.bind(h.stage),i=h.pos.x,a=h.pos.y,s=[],n=1;n<=t.range;n++)s=s.concat([e(i,a+n),e(i,a-n)]);s=s.filter(function(t){return t})}return s},renderValidActionTargets:function(t){var e=this.getValidActionTargets(t);return e.forEach(function(t){t.classList.add("valid")}),e},hideValidActionTargets:function(){$$(".valid").forEach(function(t){t.classList.remove("valid")})},render:function(t){var e=document.createElement("div");e.innerText=this.view,e.classList.add("view"),e.style.transform="rotate("+this.rotate+"deg)",e.style.filter="hue-rotate("+this.hueRotate+"deg) saturate("+this.saturate+"%)",t.appendChild(e),this.hasActed&&e.classList.add("hasActed"),this.$view=e,this.$field=t;var i=document.createElement("div");i.classList.add("health");for(var a=this.health;a>0;a--)i.innerText+="‚ù§";this.$field.appendChild(i)},renderActions:function(){var t=this,e=document.createElement("b");return t.actions.forEach(function(i){var a=document.createElement("li");if(!("move"===i.actionId&&t.hasMoved||"attack"===i.actionId&&t.hasAttacked)){var s=t.getValidActionTargets(i);"endTurn"===i.actionId||s&&s.length||a.classList.add("noRange"),a.innerText=i.view,a.dataset.actionId=i.actionId,e.appendChild(a)}},t),e.innerHTML},kill:function(){var t=this;log(t.view,"was slain!"),t._alive=!1,t.stage.removeActor(t),t.stage=n,t.pos=n,t.str=n,t.dex=n,t.int=n,t._sta=n,t.maxHealth=n,t._health=n,t.type=n,t.view=n,t.$field=n,t.$view=n,t.curAction=n,t.rotate=n,t._hasAttacked=n,t._hasMoved=n,t._hasActed=n,t.actions=n}},dp(t.prototype,"sta",{get:function(){return this._sta},set:function(t){this._sta=t,this.maxHealth=this._sta,this.health>this.maxHealth&&(this.health=this.maxHealth)}}),dp(t.prototype,"health",{get:function(){return this._health},set:function(t){this._health=t,this.health>this.maxHealth&&(this._health=this.maxHealth),this.health<=0&&this.kill()}}),dp(t.prototype,"hasActed",{get:function(){return this._hasActed},set:function(t){this._hasActed=t,this._hasAttacked=t,this._hasMoved=t}}),dp(t.prototype,"hasMoved",{get:function(){return this._hasMoved},set:function(t){t!==this._hasMoved&&(this._hasMoved=t,this._hasMoved&&this._hasAttacked&&!this.hasActed?this.hasActed=!0:t||(this._hasActed=!1))}}),dp(t.prototype,"hasAttacked",{get:function(){return this._hasAttacked},set:function(t){t!==this._hasAttacked&&(this._hasAttacked=t,this._hasMoved&&this._hasAttacked&&!this.hasActed?this.hasActed=!0:t||(this._hasActed=!1))}}),dp(t.prototype,"alive",{get:function(){return this._alive}}),dp(t.prototype,"actions",{get:function(){return this._actions},set:function(t){this._actions=t}}),window.Player=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t),this.view="üßùüèº",this.health=3,this.dex=35},e=Object.create(Player.prototype);e.constructor=t,e.getValidActionTargets=function(t){if("attack"!==t.actionId)return Player.prototype.getValidActionTargets.call(this,t);var e,i,r;return[(e=this.stage.eFByC.bind(this.stage))((i=this.pos.x)+1,(r=this.pos.y)+1),e(i-1,r-1),e(i,r-2),e(i,r-3)].filter(function(t){return t})},t.prototype=e,window.Rogue=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t),this.view="üßôüèª‚Äç‚ôÇ",this.health=2,this.dex=0,this.actions[1].range=2,this.actions[1].rangeX=2},a=Object.create(Player.prototype);a.constructor=t,a.getValidActionTargets=function(t){if("attack"!==t.actionId)return Player.prototype.getValidActionTargets.call(this,t);var a,i,e,o=[];a=this.stage.eFByC.bind(this.stage),i=this.pos.x,e=this.pos.y;for(var r,c=0;c<=2;c++)for(r=1;r<=3;r++)o=(o=(o=(o=o.concat([a(i+c,e+r)])).concat([a(i+c,e-r)])).concat([a(i-c,e+r)])).concat([a(i-c,e-r)]);return o.filter(function(t){return t})},t.prototype=a,window.Mage=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t)},i=Object.create(Player.prototype);i.constructor=t,i.push=function(){this.stage.playerPush(),log(this.view,"pushed onward!"),this.endTurn()},dp(i,"actions",{get:function(){var t=this.stage.pInF.bind(this.stage),i=this.stage.fByC.bind(this.stage);if(3!==this.pos.y||t(i(0,2))||t(i(1,2))||t(2,2))return this._actions;var s=JSON.parse(JSON.stringify(this._actions));return s[1].actionId="push",s[1].view="‚¨Ü",s},set:function(t){this._actions=t}}),t.prototype=i,window.Warrior=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t),this.type=t.E,this.view="ü¶Ç",this.playerTarget=n},e=Object.create(Player.prototype);e.constructor=t,e.determineTarget=function(){return this.playerTarget=n,this.stage.players.forEach(function(t){this.playerTarget||this.inAttackRange(t)&&(this.playerTarget=t)},this),this.playerTarget||(this.playerTarget=this.getClosest(this.stage.P)),log(this.view,"targets",this.playerTarget.view),this},e.determineAction=function(){if(this.playerTarget&&this.playerTarget.alive||this.determineTarget(),this.inAttackRange(this.playerTarget)&&!this.hasAttacked)this.selectAction("attack"),this.performSelectedAction(this.playerTarget.$field);else{if(this.hasMoved)return void this.selectAction("endTurn");var t=this.pos.x,e=this.pos.y,s=t-this.playerTarget.pos.x,i=n;2-e>0?i=this.stage.eFByC(t,e+1):s>0?i=this.stage.eFByC(t-1,e):s<0&&(i=this.stage.eFByC(t+1,e)),i?(this.selectAction("move"),this.performSelectedAction(i)):this.hasMoved=!0}this.stage.state=this.stage.S_AI},e.inAttackRange=function(t){var e=this.actions.filter(function(t){return"attack"===t.actionId})[0];return Math.abs(t.pos.y-this.pos.y)<=e.range&&Math.abs(t.pos.x-this.pos.x)<=e.rangeX},e.getClosest=function(t){var e=1/0,s=1/0,i=n;return t===this.stage.P&&this.stage.players.forEach(function(t){var a=Math.abs(t.pos.x-this.pos.x),r=Math.abs(t.pos.y-this.pos.y),h=a+r;(r<s||h<e)&&(e=h,s=r,i=t)},this),i},t.prototype=e,window.Enemy=t}()</script><script>!function(){"use strict";var t=function(t){Enemy.call(this,t),this.view="ü¶Ç",this.hueRotate=-20,this.saturate=300};(t.prototype=Object.create(Enemy.prototype)).constructor=t,window.Scorpion=t}()</script><script>!function(){"use strict";var t=function(t){Enemy.call(this,t),this.type=t.E,this.view="üï∑",this.rotate=180,this.hueRotate=120,this.saturate=600};(t.prototype=Object.create(Enemy.prototype)).constructor=t,window.Spider=t}()</script><script>!function(){"use strict";var t=function(){this.renderTargets=[],this.dirty=!1,this._state=this.S_CHAR,this._turn="",this.turn=this.P,this.currentSelection=n};t.prototype={S_CHAR:1,S_ACT:2,S_TAR:3,S_AI:4,P:1,E:2,init:function(){},addActor:function(t){this.renderTargets.push(t),this.dirty=!0},removeActor:function(t){var e=this.renderTargets.indexOf(t);-1!==e&&this.renderTargets.splice(e,1),this.dirty=!0},render:function(){mappedStage.forEach(function(t){t.forEach(function(t){t.innerText=""})}),this.renderTargets.forEach(function(t){var e=this.fByC(t.pos.x,t.pos.y);t.render(e)},this),this.dirty=!1},fByC:function(t,e,i){switch(i){case FIELD_TYPE_ENEMY:return mappedEnemyFields[e]&&mappedEnemyFields[e][t];case FIELD_TYPE_PLAYER:return mappedPlayerFields[e]&&mappedPlayerFields[e][t];case FIELD_TYPE_STAGE:default:return mappedStage[e]&&mappedStage[e][t]}},pFByC:function(t,e,i){if(e>2)return this.fByC(t,e,i)},eFByC:function(t,e,i){if(e<=2)return this.fByC(t,e,i)},pInF:function(t,e,i){var r=n;return(e?e===this.P?i?this.playersToAct:this.players:this.enemiesToAct:this.renderTargets).forEach(function(e){e.$field&&e.$field.id===t.id&&(r=e)}),r},updateAi:function(){this.state=this.S_AI;var t=this.enemiesToAct.shift();if(!t)return this.endTurn();t.determineTarget(),function(t){setTimeout(function(){this.state===this.S_AI&&t.determineAction()}.bind(this),1e3),setTimeout(function(){this.state===this.S_AI&&t.determineAction()}.bind(this),2e3),setTimeout(function(){this.state===this.S_AI&&t.determineAction()}.bind(this),3e3)}.bind(this)(t)},renderSelectAction:function(){setTimeout(function(){$(".a").innerHTML=this.currentSelection.renderActions(),this.currentSelection.$field.appendChild($(".a"))}.bind(this),100)},hideSelectAction:function(){$(".a").innerHTML="",$("#m").appendChild($(".a"))},endTurn:function(){this.enemiesToAct.length||this.playersToAct.length?log("= end of turn ="):(log("= end of round ="),this.renderTargets.forEach(function(t){t.hasActed=!1},this)),this.turn=this.turn===this.E?this.P:this.E,this.state=this.S_CHAR},playerPush:function(){var t=find($("#mm"),".active")[0];t.classList.remove("active"),t.previousSibling.classList.add("active")}},dp(t.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t,t===this.S_ACT?this.renderSelectAction():t!==this.S_TAR&&this.hideSelectAction()}}),dp(t.prototype,"turn",{get:function(){return this._turn},set:function(t){var e=$(".turn"),i=$("html").classList;this._turn=t,t===this.E?(e.innerText="Enemy",i.add("enemy")):(e.innerText="Player",i.remove("enemy")),t===this.E?(e.innerText="Enemy")&&i.add("enemy"):(e.innerText="Player")&&i.remove("enemy"),e.innerText+=" Turn",this.dirty=!0}}),dp(t.prototype,"enemies",{get:function(){return this.renderTargets.filter(function(t){return t.type===this.E},this)}}),dp(t.prototype,"players",{get:function(){return this.renderTargets.filter(function(t){return t.type===this.P},this)}}),dp(t.prototype,"enemiesToAct",{get:function(){return this.renderTargets.filter(function(t){return t.type===this.E&&!t.hasActed},this)}}),dp(t.prototype,"playersToAct",{get:function(){return this.renderTargets.filter(function(t){return t.type===this.P&&!t.hasActed},this)}}),window.mappedEnemyFields=[[$("#e-b-l"),$("#e-b-c"),$("#e-b-r")],[$("#e-m-l"),$("#e-m-c"),$("#e-m-r")],[$("#e-f-l"),$("#e-f-c"),$("#e-f-r")]],window.mappedPlayerFields=[[$("#p-f-l"),$("#p-f-c"),$("#p-f-r")],[$("#p-m-l"),$("#p-m-c"),$("#p-m-r")],[$("#p-b-l"),$("#p-b-c"),$("#p-b-r")]],window.mappedStage=mappedEnemyFields.concat(mappedPlayerFields);var e=0,i=0;mappedStage.forEach(function(t){t.forEach(function(t){t.dataset.x=e,t.dataset.y=i,e++}),i++,e=0}),window.FIELD_TYPE_PLAYER=1,window.FIELD_TYPE_ENEMY=2,window.FIELD_TYPE_STAGE=3,window.Stage=t}()</script><script>!function(){"use strict";function t(t,i,o,r){var n=new window[r](t);return n.move(i,o),n}var i=function(){Stage.call(this)},o=Object.create(Stage.prototype);o.constructor=i,o.init=function(){this.addActor(t(this,0,5,"Mage")),this.addActor(t(this,2,4,"Rogue")),this.addActor(t(this,1,3,"Warrior")),this.addActor(t(this,1,1,"Scorpion"));var i=t(this,0,1,"Spider");this.addActor(i),this.turn=this.P,$("#log").innerText=""},i.prototype=o,window.Stage1=i}()</script><script>!function(){"use strict";function t(n){if(e.turn===e.P){var a=n.target,c=e.pInF(a,e.P,!0),i=e.currentSelection;if(e.state===e.S_CHAR)c&&(e.currentSelection=c,e.state=e.S_ACT);else if(e.state===e.S_ACT){var r;(r=a.dataset.actionId)?(i.selectAction(r),n.stopPropagation()):i.hasMoved||i.hasAttacked||!c||(e.currentSelection=e.pInF(a,e.P,!0),e.state=e.S_ACT)}else e.state===e.S_TAR&&(a.classList.contains("valid")?(i.performSelectedAction(n.target),i.hasMoved&&i.hasAttacked?i.curAction&&"endTurn"===i.curAction.actionId||i.endTurn():(e.state=e.S_ACT,t(n))):(r=a.dataset.actionId)?i.selectAction(r):e.pInF(a,e.P,!0))}}var e=n,a=document.createElement("canvas"),c=a.getContext("2d");a.width=a.height=55,c.font='72px "Segoe Ui Emoji"',c.fillText("‚¨õ",-9,53),$("#m").style.backgroundImage='url("'+a.toDataURL()+'")';var i=new Stage1;e=i,i.init();var r=function(){e.turn===e.E&&e.state!==e.S_AI&&e.updateAi(),e.dirty&&e.render(),requestAnimationFrame(r)};r(),mappedStage.forEach(function(e){e.forEach(function(e){e.addEventListener("click",t)})})}()</script>