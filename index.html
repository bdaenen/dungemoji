<!doctype html><meta charset="utf-8"><style type="text/css">*{margin:0;padding:0;color:#aaa}body{overflow:hidden;position:relative}html{height:100%}.emo,table{color:red;font-size:3em}table{table-layout:fixed;width:960px;height:400px;border:1px solid red;text-align:center;border-collapse:collapse;background-color:#633f19;margin:0 auto}.emo{margin:0}#p tr:first-child td{border-top:0}tr{width:100%;height:33%}.a li,td{position:relative}td{border:1px solid #000;width:33%;height:33%}li,ul{list-style:none;margin:0;padding:0}.a,.a li:after{top:0;position:absolute}.a{display:none;bottom:0;background-color:rgba(0,0,0,.5);width:100%;z-index:1}.a li{display:inline-block;font-size:40px;height:80px;width:80px;vertical-align:middle;line-height:80px;top:30px}.a li:after{left:0;content:'‚óº';z-index:-1;font-size:80px;width:80px;height:85px}.valid{background:rgba(0,200,0,.3)}td .a{display:block}</style><div id="m"><ul class="a"></ul><table id="e"><tr id="e-b"><td id="e-b-l"></td><td id="e-b-c"></td><td id="e-b-r"></td></tr><tr id="e-m"><td id="e-m-l"></td><td id="e-m-c"></td><td id="e-m-r"></td></tr><tr id="e-f"><td id="e-f-l"></td><td id="e-f-c"></td><td id="e-f-r"></td></tr></table><table id="p"><tr id="p-f"><td id="p-f-l"></td><td id="p-f-c"></td><td id="p-f-r"></td></tr><tr id="p-m"><td id="p-m-l"></td><td id="p-m-c"></td><td id="p-m-r"></td></tr><tr id="p-b"><td id="p-b-l"></td><td id="p-b-c"></td><td id="p-b-r"></td></tr></table></div><script>window.$ = document.querySelector.bind(document);window.$$ = document.querySelectorAll.bind(document);window.find = function(parent, searchTerm){return parent.querySelectorAll(searchTerm)};</script><script>!function(){"use strict";var t=function(t){this.stage=t,this.position={x:0,y:0},this.str=10,this.dex=10,this.int=10,this._sta=10,this.maxHealth=10*this._sta,this.health=this.maxHealth,this.view="üë¶ü§µüèª",this.$field=null,this.currentAction=null,this.actions=[{actionId:"move",view:"üèÉ"},{actionId:"attack",view:"üó°"}],this.move(this.position.x,this.position.y)};t.prototype={move:function(t,i){if(this.stage.getPlayerInField(this.stage.getFieldByCoordinate(t,i)))return console.warn("cant move to occupied field"),!1;this.position.x=t,this.position.y=i,this.stage.dirty=!0},attack:function(t){var i=1;Math.random()>t.dex/100&&(Math.random()>this.dex/150&&(i=2),t.health-=2*this.str*i)},selectAction:function(t){this.currentAction=this.actions.filter(function(i){return i.actionId===t})[0],this.stage.hideSelectAction(),this.renderValidActionTargets(this.currentAction),this.state=this.GAME_STATE_SELECT_TARGET},renderValidActionTargets:function(t){if("move"===t.actionId){var i=this.stage.getPlayerFieldByCoordinate.bind(this.stage),e=this.position.x,n=this.position.y,s=[i(e+1,n),i(e-1,n),i(e,n+1),i(e,n-1)];(s=s.filter(function(t){return t})).forEach(function(t){t.classList.add("valid")})}},render:function(t){t.innerText+=this.view,t.dataset.player=this,this.$field=t},renderActions:function(){var t=document.createElement("b");return this.actions.forEach(function(i){var e=document.createElement("li");e.innerText=i.view,e.dataset.actionId=i.actionId,t.appendChild(e)},this),t.innerHTML}},Object.defineProperty(t.prototype,"sta",{get:function(){return this._sta},set:function(t){this._sta=t,this.maxHealth=10*this._sta,this.health>this.maxHealth&&(this.health=this.maxHealth)}}),window.Player=t}();</script><script>!function(){"use strict";var e=function(){this.renderTargets=[],this.dirty=!1,this._state=this.GAME_STATE_SELECT_CHARACTER,this.turn=this.TURN_PLAYER,this.currentSelection=null};e.prototype={GAME_STATE_SELECT_CHARACTER:1,GAME_STATE_SELECT_ACTION:2,GAME_STATE_SELECT_POSITION:3,GAME_STATE_SELECT_TARGET:4,TURN_PLAYER:1,TURN_ENEMY:2,init:function(){},addPlayer:function(e){this.renderTargets.push(e),this.dirty=!0},removePlayer:function(e){var t=this.renderTargets.indexOf(e);-1!==t&&this.renderTargets.splice(t,1),this.dirty=!0},render:function(){mappedStage.forEach(function(e){e.forEach(function(e){e.innerText=""})}),this.renderTargets.forEach(function(e){var t=this.getFieldByCoordinate(e.position.x,e.position.y);e.render(t)},this),this.dirty=!1},getFieldByCoordinate:function(e,t,i){switch(i){case FIELD_TYPE_ENEMY:return mappedEnemyFields[t]&&mappedEnemyFields[t][e];case FIELD_TYPE_PLAYER:return mappedPlayerFields[t]&&mappedPlayerFields[t][e];case FIELD_TYPE_STAGE:default:return mappedStage[t]&&mappedStage[t][e]}},getPlayerFieldByCoordinate:function(e,t,i){if(t>2)return this.getFieldByCoordinate(e,t,i)},getEnemyFieldByCoordinate:function(e,t,i){if(t<=2)return this.getFieldByCoordinate(e,t,i)},getPlayerInField:function(e){var t=null;return this.renderTargets.forEach(function(i){i.$field&&i.$field.id===e.id&&(t=i)}),t},renderSelectAction:function(){$(".a").innerHTML=this.currentSelection.renderActions(),this.currentSelection.$field.appendChild($(".a"))},hideSelectAction:function(){$(".a").innerHTML=""}},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e,e===this.GAME_STATE_SELECT_ACTION?this.renderSelectAction():this.hideSelectAction()}}),window.mappedEnemyFields=[[$("#e-b-l"),$("#e-b-c"),$("#e-b-r")],[$("#e-m-l"),$("#e-m-c"),$("#e-m-r")],[$("#e-f-l"),$("#e-f-c"),$("#e-f-r")]],window.mappedPlayerFields=[[$("#p-f-l"),$("#p-f-c"),$("#p-f-r")],[$("#p-m-l"),$("#p-m-c"),$("#p-m-r")],[$("#p-b-l"),$("#p-b-c"),$("#p-b-r")]],window.mappedStage=mappedEnemyFields.concat(mappedPlayerFields);var t=0,i=0;mappedStage.forEach(function(e){e.forEach(function(e){e.dataset.x=t,e.dataset.y=i,t++}),i++,t=0}),window.FIELD_TYPE_PLAYER=1,window.FIELD_TYPE_ENEMY=2,window.FIELD_TYPE_STAGE=3,window.Stage=e}();</script><script>!function(){"use strict";var t=function(){Stage.call(this)};(t.prototype=Object.create(Stage.prototype)).constructor=t,t.prototype.init=function(){var t=new Player(this);t.move(0,5),t.view="üßô",t.sta=10,this.addPlayer(t);var e=new Player(this);e.move(1,3),e.view="ü§¥üèª",this.addPlayer(e)},window.Stage1=t}();</script><script>!function(){"use strict";function t(t){if(e.turn===e.TURN_PLAYER){var a=t.target;if(e.state===e.GAME_STATE_SELECT_CHARACTER)e.currentSelection=e.getPlayerInField(a),e.currentSelection&&(e.state=e.GAME_STATE_SELECT_ACTION);else if(e.state===e.GAME_STATE_SELECT_ACTION){var n;(n=t.target.dataset.actionId)&&e.currentSelection.selectAction(n)}else e.state===e.GAME_STATE_SELECT_TARGET&&(e.currentSelection.move(t.target.dataset.x,t.target.dataset.y),e.state=e.GAME_STATE_SELECT_CHARACTER)}}var e=null,a=document.createElement("canvas"),n=a.getContext("2d");a.width=a.height=56,n.font="64px sans-serif",n.fillText("‚¨õ",-4,56),$("#m").style.backgroundImage='url("'+a.toDataURL()+'")';var r=new Stage1;e=r,r.init();var E=function(){e.dirty&&e.render(),requestAnimationFrame(E)};E(),mappedStage.forEach(function(e){e.forEach(function(e){e.addEventListener("click",t)})})}();</script>