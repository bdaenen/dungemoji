<!doctype html><meta charset="utf-8"><style type="text/css">*{margin:0;padding:0;color:#aaa}html{height:100%;background:#383838}body{position:relative}.b,.col,.g,.r{display:inline-block}.b,.g,.r{height:15px;margin-right:10px;width:15px}.col{width:33%}.r{background:#b00}.g{background:#0b0}.b{background:#00b}#m table,.emo,canvas{color:red;font-size:3em;font-family:'Segoe Ui Emoji',sans-serif}#m table{table-layout:fixed;width:960px;height:360px;border:5px solid green;text-align:center;border-collapse:collapse;background-color:#633f19;margin:0 auto}.emo,canvas{margin:0}.enemy #m table{border:5px solid red}#m table:first-of-type tr:last-child td{border-bottom:0}td,tr{width:100%;height:33%}td{border:10px solid rgba(123,77,29,.4);width:33%;position:relative}li,ul{list-style:none;margin:0;padding:0}#p tr:first-child td{border-top:0}.a{display:none;top:0;bottom:0;background-color:rgba(0,0,0,.5);width:100%;z-index:1}.a li{position:relative;display:inline-block;font-size:40px;height:80px;width:80px;vertical-align:middle;line-height:80px;top:30px}#mm,.a,.a li:after{position:absolute}.a li:after{content:'‚óº';z-index:-1;font-size:100px;width:80px;height:85px;top:-5px;left:0}.valid{background:rgba(0,200,0,.3)}td .a{display:block}.turn{position:absolute;right:0;top:55%;transform:translate(-50%,-50%);background:rgba(0,0,0,.8);padding:20px;color:green;font-size:40px}.enemy .turn{top:45%;bottom:auto;color:red}.a li[data-action-id=endTurn]:before{content:'';position:absolute;top:25px;bottom:40px;width:auto;background:#0078d7;left:20px;right:22px}.health,.view{pointer-events:none}.health{font-size:20px}.view{opacity:1}.view.hasActed{opacity:.5}.noRange{filter:grayscale(100%) brightness(40%) sepia(100%) hue-rotate(-50deg) saturate(600%) contrast(.8)}#mm{top:50%;left:-20px;transform:translate(-100%,-50%);opacity:1}#mm li,#mm ul{background:#633f19}#mm ul{border-top:5px solid red;border-bottom:5px solid green;width:100%}#mm li{height:40px;width:100px;border:4px solid #000}#mm .active,.c{position:relative}#mm .active{background:green}#mm .active:before{background:red;content:'';position:absolute;width:100%;height:100%;opacity:.3;transform:translateY(calc(-100% - 8px))}#log,.c{margin:0 auto}.c{width:960px}#log{overflow-y:scroll;height:150px;width:200px;font-family:'Segoe Ui Emoji',sans-serif}#log::-webkit-scrollbar{width:0;background:0 0}</style><div id="m"><ul class="a"></ul><div class="c"><table id="e"><tr id="e-b"><td id="e-b-l"></td><td id="e-b-c"></td><td id="e-b-r"></td></tr><tr id="e-m"><td id="e-m-l"></td><td id="e-m-c"></td><td id="e-m-r"></td></tr><tr id="e-f"><td id="e-f-l"></td><td id="e-f-c"></td><td id="e-f-r"></td></tr></table><table id="p"><tr id="p-f"><td id="p-f-l"></td><td id="p-f-c"></td><td id="p-f-r"></td></tr><tr id="p-m"><td id="p-m-l"></td><td id="p-m-c"></td><td id="p-m-r"></td></tr><tr id="p-b"><td id="p-b-l"></td><td id="p-b-c"></td><td id="p-b-r"></td></tr></table><div id="mm"><ul><li></li><li></li><li></li><li class="active"></li><li></li><li></li></ul></div></div></div><div class="c"><div id="log"></div></div><div class="turn">Player Turn</div><div class="i"><div class="col"><p>Turns are 1 character a time. Move and atk can occur in any order.</p><p>Click a character to select its action.</p></div><div class="col"><p>Goal: Clear the frontal enemy row, then make the warrior push. Push the last lane to win.</p></div><div class="col"><p><span class="r"></span>High HP, low atk. Can push enemy's lane. Low dodge chance.</p><p><span class="g"></span>Low HP, high atk. Can attack ranged or diagonal. High dodge chance.</p><p><span class="b"></span>Very low HP, avg atk. Can attack all in a row, ranged. Can't dodge.</p></div></div><script>var d=document,w=window;window.$=d.querySelector.bind(d),w.$$=d.querySelectorAll.bind(d),w.find=function(l,n){return l.querySelectorAll(n)},w.log=function(l){var n=$("#log");n.innerText+=[].join.call(arguments," ")+"\n",n.scrollTop=n.scrollHeight}</script><script>!function(){"use strict";var t=function(t){this.stage=t,this.position={x:0,y:0},this.str=1,this.dex=10,this.int=10,this._sta=6,this.maxHealth=this._sta,this._health=this._sta,this.type=t.TYPE_PLAYER,this.view="üò°",this.$field=null,this.$view=null,this.currentAction=null,this.rotate=0,this.hueRotate=0,this.saturate=100,this._hasAttacked=!1,this._hasMoved=!1,this._hasActed=!1,this._alive=!0,this._actions=[{actionId:"move",view:"üèÉ",range:1,type:t.TYPE_PLAYER},{actionId:"attack",view:"üó°",range:1,rangeX:0,type:t.TYPE_ENEMY},{actionId:"endTurn",view:"üîö",type:t.TYPE_PLAYER}]};t.prototype={move:function(t,i){return t instanceof Node?this.move(+t.dataset.x,+t.dataset.y):this.stage.getPlayerInField(this.stage.getFieldByCoordinate(t,i))?(console.warn("cant move to occupied field"),!1):(this.position.x=t,this.position.y=i,this.stage.dirty=!0,void(this.playerTarget?log(this.view,"moves towards",this.playerTarget.view):log(this.view,"moves")))},attack:function(t){if(t){var i=this.stage.getPlayerInField(t),e=1;log(this.view,"attacks",i.view),Math.random()>i.dex/100?(Math.random()<this.dex/150&&(e=2)&&log("Critical hit!"),log(i.view,"receives",2*this.str*e,"damage"),i.health-=2*this.str*e):log(i.view,"dodged!")}},selectAction:function(t){this.currentAction=this.actions.filter(function(i){return i.actionId===t})[0],this.currentAction.range?(this.hideValidActionTargets(),this.renderValidActionTargets(this.currentAction),this.stage.state=this.stage.GAME_STATE_SELECT_TARGET):this.performSelectedAction()},performSelectedAction:function(t){this.stage.hideSelectAction(),this[this.currentAction.actionId](t),"move"===this.currentAction.actionId?this.hasMoved=!0:"attack"===this.currentAction.actionId?this.hasAttacked=!0:"endTurn"===this.currentAction.actionId&&this.endTurn(),this.hideValidActionTargets(),this.stage.dirty=!0},endTurn:function(){this.stage.turn===this.type&&(this.hasActed=!0,this.stage.endTurn())},getValidActionTargets:function(t){var i,e,s,a,h;if(t.type===this.stage.TYPE_PLAYER){for(i=this.type===this.stage.TYPE_PLAYER?this.stage.getPlayerFieldByCoordinate.bind(this.stage):this.stage.getEnemyFieldByCoordinate.bind(this.stage),e=this.position.x,s=this.position.y,a=[],h=1;h<=t.range;h++)a=a.concat([i(e+h,s),i(e-h,s),i(e,s+h),i(e,s-h)]);a=a.filter(function(t){return t&&!find(t,".view").length})}if(t.type===this.stage.TYPE_ENEMY){for(i=this.type===this.stage.TYPE_PLAYER?this.stage.getEnemyFieldByCoordinate.bind(this.stage):this.stage.getPlayerFieldByCoordinate.bind(this.stage),e=this.position.x,s=this.position.y,a=[],h=1;h<=t.range;h++)a=a.concat([i(e,s+h),i(e,s-h)]);a=a.filter(function(t){return t})}return a},renderValidActionTargets:function(t){var i=this.getValidActionTargets(t);return i.forEach(function(t){t.classList.add("valid")}),i},hideValidActionTargets:function(){$$(".valid").forEach(function(t){t.classList.remove("valid")})},render:function(t){var i=document.createElement("div");i.innerText=this.view,i.classList.add("view"),i.style.transform="rotate("+this.rotate+"deg)",i.style.filter="hue-rotate("+this.hueRotate+"deg) saturate("+this.saturate+"%)",t.appendChild(i),this.hasActed&&i.classList.add("hasActed"),this.$view=i,this.$field=t;var e=document.createElement("div");e.classList.add("health");for(var s=this.health;s>0;s--)e.innerText+="‚ù§";this.$field.appendChild(e)},renderActions:function(){var t=document.createElement("b");return this.actions.forEach(function(i){var e=document.createElement("li");if(!("move"===i.actionId&&this.hasMoved||"attack"===i.actionId&&this.hasAttacked)){var s=this.getValidActionTargets(i);"endTurn"===i.actionId||s&&s.length||e.classList.add("noRange"),e.innerText=i.view,e.dataset.actionId=i.actionId,t.appendChild(e)}},this),t.innerHTML},kill:function(){log(this.view,"was slain!"),this._alive=!1,this.stage.removeActor(this),this.stage=null,this.position=null,this.str=null,this.dex=null,this.int=null,this._sta=null,this.maxHealth=null,this._health=null,this.type=null,this.view=null,this.$field=null,this.$view=null,this.currentAction=null,this.rotate=null,this._hasAttacked=null,this._hasMoved=null,this._hasActed=null,this.actions=null}},Object.defineProperty(t.prototype,"sta",{get:function(){return this._sta},set:function(t){this._sta=t,this.maxHealth=this._sta,this.health>this.maxHealth&&(this.health=this.maxHealth)}}),Object.defineProperty(t.prototype,"health",{get:function(){return this._health},set:function(t){this._health=t,this.health>this.maxHealth&&(this._health=this.maxHealth),this.health<=0&&this.kill()}}),Object.defineProperty(t.prototype,"hasActed",{get:function(){return this._hasActed},set:function(t){this._hasActed=t,this._hasAttacked=t,this._hasMoved=t}}),Object.defineProperty(t.prototype,"hasMoved",{get:function(){return this._hasMoved},set:function(t){t!==this._hasMoved&&(this._hasMoved=t,this._hasMoved&&this._hasAttacked&&!this.hasActed?this.hasActed=!0:t||(this._hasActed=!1))}}),Object.defineProperty(t.prototype,"hasAttacked",{get:function(){return this._hasAttacked},set:function(t){t!==this._hasAttacked&&(this._hasAttacked=t,this._hasMoved&&this._hasAttacked&&!this.hasActed?this.hasActed=!0:t||(this._hasActed=!1))}}),Object.defineProperty(t.prototype,"alive",{get:function(){return this._alive}}),Object.defineProperty(t.prototype,"actions",{get:function(){return this._actions},set:function(t){this._actions=t}}),window.Player=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t),this.view="üßùüèº",this.health=3,this.dex=35},i=Object.create(Player.prototype);i.constructor=t,i.getValidActionTargets=function(t){if("attack"!==t.actionId)return Player.prototype.getValidActionTargets.call(this,t);var i,e,o;return i=this.stage.getEnemyFieldByCoordinate.bind(this.stage),e=this.position.x,o=this.position.y,[i(e+1,o+1),i(e-1,o-1),i(e,o-2),i(e,o-3)].filter(function(t){return t})},t.prototype=i,window.Rogue=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t),this.view="üßôüèª‚Äç‚ôÇ",this.health=2,this.dex=0,this.actions[1].range=2,this.actions[1].rangeX=2},i=Object.create(Player.prototype);i.constructor=t,i.getValidActionTargets=function(t){if("attack"!==t.actionId)return Player.prototype.getValidActionTargets.call(this,t);var i,e,o,a=[];i=this.stage.getEnemyFieldByCoordinate.bind(this.stage),e=this.position.x,o=this.position.y;for(var n,r=0;r<=2;r++)for(n=1;n<=3;n++)a=(a=(a=(a=a.concat([i(e+r,o+n)])).concat([i(e+r,o-n)])).concat([i(e-r,o+n)])).concat([i(e-r,o-n)]);return a.filter(function(t){return t})},t.prototype=i,window.Mage=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t)},i=Object.create(Player.prototype);i.constructor=t,i.push=function(){this.stage.playerPush(),log(this.view,"pushed onward!"),this.endTurn()},Object.defineProperty(i,"actions",{get:function(){var t=this.stage.getPlayerInField.bind(this.stage),i=this.stage.getFieldByCoordinate.bind(this.stage);if(3!==this.position.y||t(i(0,2))||t(i(1,2))||t(2,2))return this._actions;var e=JSON.parse(JSON.stringify(this._actions));return e[1].actionId="push",e[1].view="‚¨Ü",e},set:function(t){this._actions=t}}),t.prototype=i,window.Warrior=t}()</script><script>!function(){"use strict";var t=function(t){Player.call(this,t),this.type=t.TYPE_ENEMY,this.view="ü¶Ç",this.playerTarget=null},e=Object.create(Player.prototype);e.constructor=t,e.determineTarget=function(){return this.playerTarget=null,this.stage.players.forEach(function(t){this.playerTarget||this.inAttackRange(t)&&(this.playerTarget=t)},this),this.playerTarget||(this.playerTarget=this.getClosest(this.stage.TYPE_PLAYER)),log(this.view,"targets",this.playerTarget.view),this},e.determineAction=function(){if(this.playerTarget&&this.playerTarget.alive||this.determineTarget(),this.inAttackRange(this.playerTarget)&&!this.hasAttacked)this.selectAction("attack"),this.performSelectedAction(this.playerTarget.$field);else{if(this.hasMoved)return void this.selectAction("endTurn");var t=this.position.x,e=this.position.y,i=t-this.playerTarget.position.x,s=null;2-e>0?s=this.stage.getEnemyFieldByCoordinate(t,e+1):i>0?s=this.stage.getEnemyFieldByCoordinate(t-1,e):i<0&&(s=this.stage.getEnemyFieldByCoordinate(t+1,e)),s?(this.selectAction("move"),this.performSelectedAction(s)):this.hasMoved=!0}this.stage.state=this.stage.GAME_STATE_AI_BUSY},e.inAttackRange=function(t){var e=this.actions.filter(function(t){return"attack"===t.actionId})[0];return Math.abs(t.position.y-this.position.y)<=e.range&&Math.abs(t.position.x-this.position.x)<=e.rangeX},e.getClosest=function(t){var e=1/0,i=1/0,s=null;return t===this.stage.TYPE_PLAYER&&this.stage.players.forEach(function(t){var a=Math.abs(t.position.x-this.position.x),n=Math.abs(t.position.y-this.position.y),r=a+n;(n<i||r<e)&&(e=r,i=n,s=t)},this),s},t.prototype=e,window.Enemy=t}()</script><script>!function(){"use strict";var t=function(t){Enemy.call(this,t),this.view="ü¶Ç",this.hueRotate=-20,this.saturate=300};(t.prototype=Object.create(Enemy.prototype)).constructor=t,window.Scorpion=t}()</script><script>!function(){"use strict";var t=function(t){Enemy.call(this,t),this.type=t.TYPE_ENEMY,this.view="üï∑",this.rotate=180,this.hueRotate=120,this.saturate=600};(t.prototype=Object.create(Enemy.prototype)).constructor=t,window.Spider=t}()</script><script>!function(){"use strict";var e=function(){this.renderTargets=[],this.dirty=!1,this._state=this.GAME_STATE_SELECT_CHARACTER,this._turn="",this.turn=this.TYPE_PLAYER,this.currentSelection=null};e.prototype={GAME_STATE_SELECT_CHARACTER:1,GAME_STATE_SELECT_ACTION:2,GAME_STATE_SELECT_TARGET:3,GAME_STATE_AI_BUSY:4,TYPE_PLAYER:1,TYPE_ENEMY:2,init:function(){},addActor:function(e){this.renderTargets.push(e),this.dirty=!0},removeActor:function(e){var t=this.renderTargets.indexOf(e);-1!==t&&this.renderTargets.splice(t,1),this.dirty=!0},render:function(){mappedStage.forEach(function(e){e.forEach(function(e){e.innerText=""})}),this.renderTargets.forEach(function(e){var t=this.getFieldByCoordinate(e.position.x,e.position.y);e.render(t)},this),this.dirty=!1},getFieldByCoordinate:function(e,t,i){switch(i){case FIELD_TYPE_ENEMY:return mappedEnemyFields[t]&&mappedEnemyFields[t][e];case FIELD_TYPE_PLAYER:return mappedPlayerFields[t]&&mappedPlayerFields[t][e];case FIELD_TYPE_STAGE:default:return mappedStage[t]&&mappedStage[t][e]}},getPlayerFieldByCoordinate:function(e,t,i){if(t>2)return this.getFieldByCoordinate(e,t,i)},getEnemyFieldByCoordinate:function(e,t,i){if(t<=2)return this.getFieldByCoordinate(e,t,i)},getPlayerInField:function(e,t,i){var n=null;return(t?t===this.TYPE_PLAYER?i?this.playersToAct:this.players:this.enemiesToAct:this.renderTargets).forEach(function(t){t.$field&&t.$field.id===e.id&&(n=t)}),n},updateAi:function(){this.state=this.GAME_STATE_AI_BUSY;var e=this.enemiesToAct.shift();if(!e)return this.endTurn();e.determineTarget(),function(e){setTimeout(function(){this.state===this.GAME_STATE_AI_BUSY&&e.determineAction()}.bind(this),1e3),setTimeout(function(){this.state===this.GAME_STATE_AI_BUSY&&e.determineAction()}.bind(this),2e3),setTimeout(function(){this.state===this.GAME_STATE_AI_BUSY&&e.determineAction()}.bind(this),3e3)}.bind(this)(e)},renderSelectAction:function(){setTimeout(function(){$(".a").innerHTML=this.currentSelection.renderActions(),this.currentSelection.$field.appendChild($(".a"))}.bind(this),100)},hideSelectAction:function(){$(".a").innerHTML="",$("#m").appendChild($(".a"))},endTurn:function(){this.enemiesToAct.length||this.playersToAct.length?log("= end of turn ="):(log("= end of round ="),this.renderTargets.forEach(function(e){e.hasActed=!1},this)),this.turn=this.turn===this.TYPE_ENEMY?this.TYPE_PLAYER:this.TYPE_ENEMY,this.state=this.GAME_STATE_SELECT_CHARACTER},playerPush:function(){var e=find($("#mm"),".active")[0];e.classList.remove("active"),e.previousSibling.classList.add("active")}},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e,e===this.GAME_STATE_SELECT_ACTION?this.renderSelectAction():e!==this.GAME_STATE_SELECT_TARGET&&this.hideSelectAction()}}),Object.defineProperty(e.prototype,"turn",{get:function(){return this._turn},set:function(e){var t=$(".turn"),i=$("html").classList;this._turn=e,e===this.TYPE_ENEMY?(t.innerText="Enemy",i.add("enemy")):(t.innerText="Player",i.remove("enemy")),e===this.TYPE_ENEMY?(t.innerText="Enemy")&&i.add("enemy"):(t.innerText="Player")&&i.remove("enemy"),t.innerText+=" Turn",this.dirty=!0}}),Object.defineProperty(e.prototype,"enemies",{get:function(){return this.renderTargets.filter(function(e){return e.type===this.TYPE_ENEMY},this)}}),Object.defineProperty(e.prototype,"players",{get:function(){return this.renderTargets.filter(function(e){return e.type===this.TYPE_PLAYER},this)}}),Object.defineProperty(e.prototype,"enemiesToAct",{get:function(){return this.renderTargets.filter(function(e){return e.type===this.TYPE_ENEMY&&!e.hasActed},this)}}),Object.defineProperty(e.prototype,"playersToAct",{get:function(){return this.renderTargets.filter(function(e){return e.type===this.TYPE_PLAYER&&!e.hasActed},this)}}),window.mappedEnemyFields=[[$("#e-b-l"),$("#e-b-c"),$("#e-b-r")],[$("#e-m-l"),$("#e-m-c"),$("#e-m-r")],[$("#e-f-l"),$("#e-f-c"),$("#e-f-r")]],window.mappedPlayerFields=[[$("#p-f-l"),$("#p-f-c"),$("#p-f-r")],[$("#p-m-l"),$("#p-m-c"),$("#p-m-r")],[$("#p-b-l"),$("#p-b-c"),$("#p-b-r")]],window.mappedStage=mappedEnemyFields.concat(mappedPlayerFields);var t=0,i=0;mappedStage.forEach(function(e){e.forEach(function(e){e.dataset.x=t,e.dataset.y=i,t++}),i++,t=0}),window.FIELD_TYPE_PLAYER=1,window.FIELD_TYPE_ENEMY=2,window.FIELD_TYPE_STAGE=3,window.Stage=e}()</script><script>!function(){"use strict";function t(t,i,o,r){var n=new window[r](t);return n.move(i,o),n}var i=function(){Stage.call(this)},o=Object.create(Stage.prototype);o.constructor=i,o.init=function(){this.addActor(t(this,0,5,"Mage")),this.addActor(t(this,2,4,"Rogue")),this.addActor(t(this,1,3,"Warrior")),this.addActor(t(this,1,1,"Scorpion"));var i=t(this,0,1,"Spider");this.addActor(i),this.turn=this.TYPE_PLAYER,$("#log").innerText=""},i.prototype=o,window.Stage1=i}()</script><script>!function(){"use strict";function t(n){if(e.turn===e.TYPE_PLAYER){var a=n.target,E=e.getPlayerInField(a,e.TYPE_PLAYER,!0),i=e.currentSelection;if(e.state===e.GAME_STATE_SELECT_CHARACTER)E&&(e.currentSelection=E,e.state=e.GAME_STATE_SELECT_ACTION);else if(e.state===e.GAME_STATE_SELECT_ACTION){var r;(r=a.dataset.actionId)?(i.selectAction(r),n.stopPropagation()):i.hasMoved||i.hasAttacked||!E||(e.currentSelection=e.getPlayerInField(a,e.TYPE_PLAYER,!0),e.state=e.GAME_STATE_SELECT_ACTION)}else e.state===e.GAME_STATE_SELECT_TARGET&&(a.classList.contains("valid")?(i.performSelectedAction(n.target),i.hasMoved&&i.hasAttacked?i.currentAction&&"endTurn"===i.currentAction.actionId||i.endTurn():(e.state=e.GAME_STATE_SELECT_ACTION,t(n))):(r=a.dataset.actionId)?i.selectAction(r):e.getPlayerInField(a,e.TYPE_PLAYER,!0))}}var e=null,n=document.createElement("canvas"),a=n.getContext("2d");n.width=n.height=55,a.font='72px "Segoe Ui Emoji"',a.fillText("‚¨õ",-9,53),$("#m").style.backgroundImage='url("'+n.toDataURL()+'")';var E=new Stage1;e=E,E.init();var i=function(){e.turn===e.TYPE_ENEMY&&e.state!==e.GAME_STATE_AI_BUSY&&e.updateAi(),e.dirty&&e.render(),requestAnimationFrame(i)};i(),mappedStage.forEach(function(e){e.forEach(function(e){e.addEventListener("click",t)})})}()</script>